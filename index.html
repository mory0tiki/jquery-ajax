<!DOCTYPE HTML/>

<html>
	<head>
		<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
		<script src="js/json_request.js"></script>

		<script src="js/jquery.jsonview.js"></script>

		<link rel='stylesheet' href="css/jquery.jsonview.css"></link>

		<script>
			function getCookie(name)
			{
				var cookieValue = null;
				if (document.cookie && document.cookie != '') {
					var cookies = document.cookie.split(';');
					for (var i = 0; i < cookies.length; i++) {
						var cookie = jQuery.trim(cookies[i]);
						// Does this cookie string begin with the name we want?

						if (cookie.substring(0, name.length + 1) == (name + '=')) {
							cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
							break;
						}
					}
				}
				return cookieValue;
			}

			function setCookie(name,value,expires,path,domain,secure) {
				var cookieString = name + "=" +escape(value) +
				( (expires) ? ";expires=" + expires.toGMTString() : "") +
				( (path) ? ";path=" + path : "") +
				( (domain) ? ";domain=" + domain : "") +
				( (secure) ? ";secure" : "");
				document.cookie = cookieString;
			}

			$.get('http://23.92.220.46:8000/repo/item/', function(data){

				$.ajaxSetup({ 
					beforeSend: function(xhr, settings) {
						if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
							// Only send the token to relative URLs i.e. locally.
							xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
						}
					} 
				});
			})
				function login(){
					JsonRequest.send("auth/Login/", "POST",{username: "admin", password: "111111"},function (data){
						console.log(data);
						$('#result').val(JSON.stringify(data));
					});
			}

			function getItem(){

				JsonRequest.send('repo/item/',function(data){
					console.log(data);
					$('#result').val(JSON.stringify(data));
				});
			}

			function getMedCondition(){

				JsonRequest.send('repo/medical_condition/',function(data){
					console.log(data);
					$('#result').val(JSON.stringify(data));
				});
			}

			function sendRequest(){
				url = $("#url").val()
				method = $("#method").val()
				data = $("#data").val()

				JsonRequest.send(url, method, data, function(result){
					console.log(result);
					$("#result").val(JSON.stringify(result));
					$("#json").JSONView(JSON.stringify(result), {collapsed: true});
				});
			}
		</script>
	</head>

	<body>
		<button onclick="login()" >Login</button>
		<button onclick="getItem()">Get Items</button>
		<button onclick="getMedCondition()">Get Medical Condition</button>
		<br/>
		<label for='url'> http://23.92.220.46/ </label>
		<input type="text" id='url'></input>
		<select id='method'>
			<option value='GET'>GET</option>
			<option value='POST'>POST</option>
			<option value='PUT'>PUT</option>
			<option value='DELETE'>DELETE</option>
			<option value='OPTIONS'>OPTIONS</option>
		</select>
		<br/>
		<label for='data'> Data </label>
		<textarea id='data'  style="width:100%; height:100px;"></textarea> 
		<br/>
		<button onclick="sendRequest()">Send</button>
		<br/>
		<hr/>
		<label for='result'> Result </label>
		<textarea id='result' type='textarea' style="width:100%; height:300px;"></textarea>
		<hr/>
		<div id='json'></div>
	</body>
</html>
